<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Markov Chain và bài toán ‘Sáng nay ăn gì’" /><meta name="author" content="tuanio" /><meta property="og:locale" content="en" /><meta name="description" content="Nội dung 1. Định nghĩa Markov chain 2. Bài toán “sáng nay ăn gì” 3. Tổng kết" /><meta property="og:description" content="Nội dung 1. Định nghĩa Markov chain 2. Bài toán “sáng nay ăn gì” 3. Tổng kết" /><link rel="canonical" href="https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/" /><meta property="og:url" content="https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/" /><meta property="og:site_name" content="tuanio" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-26T21:35:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Markov Chain và bài toán ‘Sáng nay ăn gì’" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@tuanio" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"tuanio"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/"},"description":"Nội dung 1. Định nghĩa Markov chain 2. Bài toán “sáng nay ăn gì” 3. Tổng kết","url":"https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/","@type":"BlogPosting","headline":"Markov Chain và bài toán ‘Sáng nay ăn gì’","dateModified":"2022-08-28T19:56:09+07:00","datePublished":"2021-12-26T21:35:00+07:00","@context":"https://schema.org"}</script><title>Markov Chain và bài toán 'Sáng nay ăn gì' | tuanio</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="tuanio"><meta name="application-name" content="tuanio"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://deforani.sirv.com/Images/tuanio.github.io/avatar/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">tuanio</a></div><div class="site-subtitle font-italic">Một nơi để viết về những gì tôi đã học</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/tuanio" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.facebook.com/tuanio1211/" aria-label="facebook" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['nvatuan3','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/tuanio" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Markov Chain và bài toán 'Sáng nay ăn gì'</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Markov Chain và bài toán 'Sáng nay ăn gì'</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> tuanio </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 26, 2021, 9:35 PM +0700" >Dec 26, 2021<i class="unloaded">2021-12-26T21:35:00+07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 28, 2022, 7:56 PM +0700" >Aug 28<i class="unloaded">2022-08-28T19:56:09+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1745 words">9 min read</span></div></div><div class="post-content"><h3 id="nội-dung">Nội dung</h3><ul><li><a href="#-dinh-nghia">1. Định nghĩa Markov chain</a><li><a href="#-bai-toan-sang-nay-an-gi">2. Bài toán “sáng nay ăn gì”</a><li><a href="#-tong-ket">3. Tổng kết</a></ul><p>Trong bài viết này, chúng ta sẽ đi qua sơ lược về định nghĩa của Markov chain, từ đó hiểu thêm về Markov chain để ứng dụng vào một bài toán và thực nghiệm bằng Python.</p><p><a name="-dinh-nghia"></a></p><h1 id="1-định-nghĩa-markov-chain">1. Định nghĩa Markov chain</h1><p>Markov chain (<a href="https://en.wikipedia.org/wiki/Markov_chain" target="_blank">chuỗi Markov</a>), được đặt theo tên nhà toán học người Nga <a href="https://en.wikipedia.org/wiki/Andrey_Markov" target="_blank">Andrey Markov</a>, là một mô hình ngẫu nhiên hay <a href="https://en.wikipedia.org/wiki/Stochastic_process" target="_blank">tiến trình ngẫu nhiên</a> mô tả một chuỗi các sự kiện có khả năng xảy ra, mà xác suất để xảy ra sự kiện tiếp theo phụ thuộc chỉ vào sự kiện hiện tại. Đây là một mô hình <em>“không có trí nhớ”</em> (memorylessness), nghĩa là các sự kiện xảy ra trong quá khứ sẽ không được ghi nhớ, sự kiện trong tương lai chỉ phụ thuộc sự kiện hiện tại của mô hình.</p><p>Markov chain là sự kết hợp bởi 2 thành phần: tập trạng thái $Q$ và ma trận chuyển đổi giữa các trạng thái $P$ (ma trận này sẽ là ma trận vuông).</p><p><strong>Ví dụ</strong>, ta định nghĩa Markov chain $\text{MC}$ có:</p><ul><li>Tập trạng thái là $Q = { Q_1, Q_2, Q_3 }$<li>Ma trận chuyển đổi giứa các trạng thái là $\begin{aligned} P = \begin{bmatrix} P_{11} &amp; P_{12} &amp; P_{13} \newline P_{21} &amp; P_{22} &amp; P_{23} \newline P_{31} &amp; P_{32} &amp; P_{33} \end{bmatrix}\end{aligned}$</ul><p>Markov chain $\text{MC}$ sẽ có hình dạng trông giống như một đồ thị có hướng, có trọng số, với các node trên đồ thị là các trạng thái trong tập trạng thái của Markov chain, và các trọng số trên các cạnh của đồ thị mô tả xác suất chuyển $P_{ij}$, là xác suất để di chuyển từ trạng thái $Q_i$ đến trạng thái $Q_j$. Nếu $P_{ij} = 0$, ta ngầm hiểu rằng không thể di chuyển giữa hai trạng thái $Q_i$ và $Q_j$. ⚠️ <strong>Lưu ý</strong> là các trạng thái cũng có thể quay trở về chính nó, ví dụ $P_{33}$ là xác suất để thời điểm hiện tại, Markov chain đang ở trạng thái $Q_3$ và thời điểm tiếp theo sẽ quay trở lại $Q_3$. Hình dưới đây mô tả Markov chain $\text{MC}$.</p><p><img data-proofer-ignore data-src="/assets/markov_chain/mc_ex.png" alt="mc_ex" /></p><p>Để quan sát được đường đi của các trạng thái trong Markov chain, ta cần định nghĩa quan sát $X = (X_1, X_2, \cdots, X_t, \cdots, X_T)$ là một vector có $T$ thành phần, mô tả các quan sát của Markov chain theo thời gian, $X_t \in Q$. $X=(X_1 = Q_1, X_2 = Q_1, X_3 = Q_2, X_4 = Q_3)$ là một ví dụ về chuỗi quan sát các trạng thái của Markov chain, với xác suất xảy ra chuỗi quan sát này là tích các xác suất chuyển đổi, $P(X) = \prod_{i=1}^{T-1} X_{i}X_{i+1}$, trong ví dụ của chúng ta thì sẽ là $P(X) = P_{11}P_{12}P_{23}$, trên thực tế, ta có thể lấy logarit của $P(X)$, tạo thuận lợi cho việc tính toán, tránh bị tràn số trong các chương trình máy tính.</p><p>Cụ thể hơn về ký hiệu toán học của xác suất chuyển đổi, $P_{ij}=Pr(X_{t+1} = Q_j|X_t = Q_i)$ là xác suất để thời điểm $t$, trạng thái hiện tại của Markov chain là $Q_i$, và trạng thái của quan sát trong tương lai $t+1$ là $Q_{j}$.</p><p><a name="-bai-toan-sang-nay-an-gi"></a></p><h1 id="2-bài-toán-sáng-nay-ăn-gì">2. Bài toán “Sáng nay ăn gì”</h1><p>Giả sử vào một buổi sáng nọ, bạn thức dậy với 2 lần reo chuông báo thức đã qua từ điện thoại, bạn ngồi dậy, với cái bụng đang reo lên, bạn liền suy nghĩ đến việc: sáng hôm nay mình sẽ ăn gì?. Sau khi ra đầu ngõ, bạn đứng trước “ngã tư”: quán phở cô Ba, xe bánh mì cô Hai, cơm tấm chú Sáu và xe súp cua của ông Bảy. Tuy rằng, bạn đã ăn sáng mấy chục năm cuộc đời rồi, nhưng việc lựa chọn món ăn chưa bao giờ là dễ cả. May mắn thay, trong một năm vừa qua, món ăn sáng của mỗi ngày đều đã được bạn lưu trữ trên điện thoại, trong ứng dụng ghi chú (đây chính là data quý giá). Sau khi đọc định nghĩa về Markov chain ở trên, bạn quyết định áp dụng để giải quyết bài toán “sáng nay ăn gì” này.</p><p>Đó chỉ là một câu chuyện vui do tôi bịa ra để dẫn vào bài toán có thể giải quyết bằng Markov chain này. Trên thực tế, Markov chain có thể giải các bài toán to lớn hơn, nhưng trước tiên chúng ta cứ giải bài toán kia để bạn có thể lấp đầy cái bụng đã.</p><p>Trong ví dụ này, tôi sẽ hiện thực bằng Python, đọc data theo thời gian lên và tìm bộ các trạng thái $Q$, rồi tìm xác suất của ma trận $P$ kia, sau đó chọn ngẫu nhiên trạng thái (món ăn sáng) tiếp theo trên phân phối đã biết của xác suất của trạng thái (món ăn) hiện tại. Bạn có thể tải data ở <a href="https://github.com/tuanio/tuanio.github.io/blob/main/assets/markov_chain/code/breakfast.csv" target="_blank">đây</a></p><p>Đối với bộ data ở trên, tập trạng thái của chúng ta sẽ là $Q={\text{Phở}, \text{Cơm tấm}, \text{Bánh mì}, \text{Súp cua}}$</p><p>Trước tiên ta sẽ phải import các thư viện cần thiết vào Python</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> <span class="c1"># tính toán trên ma trận
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span> <span class="c1"># đọc dữ liệu từ file csv
</span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="c1"># dùng cho mục đích in "đẹp"
</span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="c1"># để đếm số lượng lần xảy ra của các trạng thái (đơn lẻ và cặp)
</span></pre></table></code></div></div><p>Đọc dữ liệu và chuyển thành dạng list trong Python để dễ dàng sử dụng</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'breakfast.csv'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">Food</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="c1"># xuất ra 5 món ăn cuối cùng bạn ăn
</span></pre></table></code></div></div><pre><code class="language-plain">['Phở', 'Cơm tấm', 'Bánh mì', 'Phở', 'Phở']
</code></pre><p>Để có thể tạo ma trận P, trước tiên ta phải đếm các cặp và các giá trị đơn lẻ trước, sau đó đi chuẩn hóa</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1"># tạo nơi lưu trữ giá trị
</span><span class="n">food_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">food_pair_count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
</pre></table></code></div></div><p>Đếm các giá trị</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1"># food_count: đếm số lần xuất hiện của một trạng thái
# food_pair_count: đếm tất cả các cặp trạng thái có thể [current][future]
</span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">food_count</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># self loop
</span>        <span class="n">food_pair_count</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">break</span>
    <span class="n">food_pair_count</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></table></code></div></div><p>Chuẩn hóa theo tổng hàng</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># chuẩn hóa theo tổng hàng
</span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">food_pair_count</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">food_pair_count</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">/=</span> <span class="n">food_count</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1"># chuẩn hóa
</span></pre></table></code></div></div><p>Do ma trận không giống như dictionary trong Python, ta chỉ có thể truy cập được bằng chỉ mục (index) của trạng thái, vì vậy ta cần phải có một dictionary lưu trữ các index của các trạng thái</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># lấy index của các món ăn để dễ thao tác
</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">food_count</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
<span class="n">key_to_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span> <span class="c1"># key to index
</span><span class="k">print</span><span class="p">(</span><span class="n">key_to_idx</span><span class="p">)</span>
</pre></table></code></div></div><pre><code class="language-plain">{'Bánh mì': 0, 'Cơm tấm': 1, 'Phở': 2, 'Súp cua': 3}
</code></pre><p>Ta bây giờ có thể tạo ma trận $P$ từ xác suất đã chuẩn hóa từ bước trên, và nên chuyển từ list sang numpy để tiện lợi cho việc tính toán hơn, do numpy là một thư viện rất mạnh của Python trong việc xử lý các thao tác liên quan đến đại số tuyến tính.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">P</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">food_pair_count</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">P</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>
        
<span class="c1"># chuyển list sang numpy để dễ tính toán
</span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Ma trận chuyển trạng thái P: '</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></table></code></div></div><pre><code class="language-plain">Ma trận chuyển trạng thái P: 
array([[0.26582278, 0.26582278, 0.26582278, 0.20253165],
       [0.25274725, 0.20879121, 0.24175824, 0.2967033 ],
       [0.28571429, 0.25274725, 0.28571429, 0.17582418],
       [0.25961538, 0.33653846, 0.21153846, 0.19230769]])
</code></pre><p>Ta có thể kiểm tra tổng hàng xem có bằng $1$ hay chưa, nếu chưa có thể do lỗi ở các bước trước.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1"># tổng hàng của ma trận phải luôn bằng 1
</span><span class="k">print</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></table></code></div></div><pre><code class="language-plain">[1. 1. 1. 1.] # tất cả đều 1, chuẩn 
</code></pre><p>Bây giờ, phần cuối sẽ đi dự đoán món ăn. Việc dự đoán món ăn (trạng thái) tương lai khá đơn giản, ta có thể hình dung thế này: đứng ở node của trạng thái hiện tại (món ăn cuối cùng của tập dữ liệu - món ăn hôm trước), có một tập các giá trị xác suất tương ứng với trọng số của các cạnh để đi đến node khác, chọn ngẫu nhiên một node để đi đến từ tập xác suất đó (một phân phối), và ta có thể chọn ngẫu nhiên theo phân phối với hàm <code class="language-plaintext highlighter-rouge">numpy.random.choice</code>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># dự đoán món ăn 
</span><span class="n">curr_food</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">curr_distribution</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">key_to_idx</span><span class="p">[</span><span class="n">curr_food</span><span class="p">]]</span>
<span class="n">predicted_food</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">curr_distribution</span><span class="p">)</span> <span class="c1"># random walk with known distribution
</span><span class="n">predicted_probability</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">key_to_idx</span><span class="p">[</span><span class="n">curr_food</span><span class="p">]][</span><span class="n">key_to_idx</span><span class="p">[</span><span class="n">predicted_food</span><span class="p">]]</span>
</pre></table></code></div></div><p>In ra kết quả dự đoán</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Món ăn chúng ta ăn hôm trước: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Món ăn nên ăn vào hôm nay là "</span><span class="si">{</span><span class="n">predicted_food</span><span class="si">}</span><span class="s">"</span><span class="se">\
</span><span class="s"> với khả năng xảy ra là </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">predicted_probability</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s">%'</span><span class="p">)</span>
</pre></table></code></div></div><pre><code class="language-plain">Món ăn chúng ta ăn hôm trước: Phở
Món ăn nên ăn vào hôm nay là "Bánh mì" với khả năng xảy ra là 28.57%
</code></pre><p>Vậy mô hình Markov chain chúng ta đã hiện thực đã dự đoán cho chúng ta món “Bánh mì” vào hôm nay.</p><p>⚠️ <strong>Lưu ý</strong>: Các giá trị, số liệu được xuất ra trong bài có thể khác, tùy thuộc vào dữ liệu cung cấp và sự lựa chọn ngẫu nhiên của các hàm trên.</p><p><em>Chi tiết toàn bộ code, bạn đọc có thể tham khảo ở <a href="https://github.com/tuanio/tuanio.github.io/blob/main/assets/markov_chain/code/main.ipynb" target="_blank">đây</a></em></p><p><a name="-tong-ket"></a></p><h1 id="3-tổng-kết">3. Tổng kết</h1><p>Trên đây chỉ là một ví dụ nhỏ để mô tả khả năng của Markov chain. Ta có thể bắt gặp Markov chain trong nhiều bài toán khác như xây dựng <a href="https://en.wikipedia.org/wiki/N-gram" target="_blank">mô hình ngôn ngữ n-gram</a> trong lĩnh vực Xử lý ngôn ngữ tự nhiên, có thể ứng dụng vào việc <a href="https://en.wikipedia.org/wiki/PageRank" target="_blank">Xếp hạng trang (PageRank)</a> của Google (nhưng trên thực tế, Google sử dụng các mô hình phức tạp hơn Markov chain). Markov chain có thể phát triển lên một dạng khác, <a href="https://en.wikipedia.org/wiki/Hidden_Markov_model" target="_blank">mô hình Markov ẩn</a>, mà có thể ứng dụng trong bài toán <a href="https://en.wikipedia.org/wiki/Speech_recognition" target="_blank">Nhận dạng giọng nói</a>. Và rất nhiều các ứng dụng khác trong các lĩnh vực Vật lý, Hóa học, Sinh học, Lý thuyết hàng đợi, … Bạn đọc có thể đọc thêm ở đường link <a href="https://en.wikipedia.org/wiki/Markov_chain" target="_bank">này</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/knowledge/'>knowledge</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/machine-learning/" class="post-tag no-text-decoration" >machine learning</a> <a href="/tags/probability/" class="post-tag no-text-decoration" >probability</a> <a href="/tags/markov-chain/" class="post-tag no-text-decoration" >markov chain</a> <a href="/tags/markov-process/" class="post-tag no-text-decoration" >markov process</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Markov Chain và bài toán 'Sáng nay ăn gì' - tuanio&url=https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Markov Chain và bài toán 'Sáng nay ăn gì' - tuanio&u=https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Markov Chain và bài toán 'Sáng nay ăn gì' - tuanio&url=https://tuanio.github.io//posts/markov-chain-va-bai-toan-sang-nay-an-gi/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/autorec/">AutoRec: Autoencoder dành cho Collaborative Filtering</a><li><a href="/posts/source-nlp/">Nguồn tài liệu để học NLP</a><li><a href="/posts/markov-chain-va-bai-toan-sang-nay-an-gi/">Markov Chain và bài toán 'Sáng nay ăn gì'</a><li><a href="/posts/minh-da-hoc-duoc-ghi-trong-nam-nay/">Mình đã học được gì trong năm nay?</a><li><a href="/posts/hidden-markov-model-and-sentiment-analysis/">Mô hình Markov ẩn và bài toán phân tích cảm xúc văn bản</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/autoencoder/">autoencoder</a> <a class="post-tag" href="/tags/feedforward-neural-network/">feedforward neural network</a> <a class="post-tag" href="/tags/markov-process/">markov process</a> <a class="post-tag" href="/tags/nlp/">nlp</a> <a class="post-tag" href="/tags/probability/">probability</a> <a class="post-tag" href="/tags/supervised-learning/">supervised learning</a> <a class="post-tag" href="/tags/alexnet/">alexnet</a> <a class="post-tag" href="/tags/anomaly-detection/">anomaly detection</a> <a class="post-tag" href="/tags/audio-classification/">audio classification</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hidden-markov-model-and-sentiment-analysis/"><div class="card-body"> <span class="timeago small" >Jan 3<i class="unloaded">2022-01-03T20:51:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mô hình Markov ẩn và bài toán phân tích cảm xúc văn bản</h3><div class="text-muted small"><p> Nội dung 1. Định nghĩa 2. Ba bài toán nền tảng 3. Bài toán phân tích cảm xúc văn bản 3.1 Giới thiệu bài toán phân tích cảm xúc văn bản 3.2 Bộ dữ liệu Financial News của Kagg...</p></div></div></a></div><div class="card"> <a href="/posts/source-nlp/"><div class="card-body"> <span class="timeago small" >Dec 23, 2021<i class="unloaded">2021-12-23T15:11:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nguồn tài liệu để học NLP</h3><div class="text-muted small"><p> Bài viết này mang tính chất lưu trữ và chia sẻ. Những nguồn khi mới bắt đầu How to get started in nlp - medium Dữ liệu nlp-datasets - github Sách Deep Learning for NLP and Speech R...</p></div></div></a></div><div class="card"> <a href="/posts/elm/"><div class="card-body"> <span class="timeago small" >Jan 10<i class="unloaded">2022-01-10T21:07:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Extreme Learning Machine: Thuật toán học nhanh cho mạng neuron truyền thẳng một lớp ẩn</h3><div class="text-muted small"><p> Nội dung 1. Mạng neuron truyền thẳng một lớp ẩn 1.1 Định nghĩa 1.2 Bài toán học tham số 2. Thuật toán Extreme Learning Machine 3. Thực nghiệm thuật toán Extreme Lear...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/source-nlp/" class="btn btn-outline-primary" prompt="Older"><p>Nguồn tài liệu để học NLP</p></a> <a href="/posts/minh-da-hoc-duoc-ghi-trong-nam-nay/" class="btn btn-outline-primary" prompt="Newer"><p>Mình đã học được gì trong năm nay?</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/tuanio">Nguyễn Văn Anh Tuấn</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/autoencoder/">autoencoder</a> <a class="post-tag" href="/tags/feedforward-neural-network/">feedforward neural network</a> <a class="post-tag" href="/tags/markov-process/">markov process</a> <a class="post-tag" href="/tags/nlp/">nlp</a> <a class="post-tag" href="/tags/probability/">probability</a> <a class="post-tag" href="/tags/supervised-learning/">supervised learning</a> <a class="post-tag" href="/tags/alexnet/">alexnet</a> <a class="post-tag" href="/tags/anomaly-detection/">anomaly detection</a> <a class="post-tag" href="/tags/audio-classification/">audio classification</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-ZJYTV5L278"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZJYTV5L278'); }); </script>
